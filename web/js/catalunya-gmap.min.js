(()=>{"use strict";function e(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}"function"==typeof SuppressedError&&SuppressedError;var t=e((function e(t,i){if(t===i)return!0;if(t&&i&&"object"==typeof t&&"object"==typeof i){if(t.constructor!==i.constructor)return!1;var s,r,a;if(Array.isArray(t)){if((s=t.length)!=i.length)return!1;for(r=s;0!=r--;)if(!e(t[r],i[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===i.source&&t.flags===i.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===i.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===i.toString();if((s=(a=Object.keys(t)).length)!==Object.keys(i).length)return!1;for(r=s;0!=r--;)if(!Object.prototype.hasOwnProperty.call(i,a[r]))return!1;for(r=s;0!=r--;){var o=a[r];if(!e(t[o],i[o]))return!1}return!0}return t!=t&&i!=i}));const i="__googleMapsScriptId";var s;!function(e){e[e.INITIALIZED=0]="INITIALIZED",e[e.LOADING=1]="LOADING",e[e.SUCCESS=2]="SUCCESS",e[e.FAILURE=3]="FAILURE"}(s||(s={}));class r{constructor({apiKey:e,authReferrerPolicy:s,channel:a,client:o,id:n=i,language:l,libraries:c=[],mapIds:d,nonce:h,region:g,retries:p=3,url:m="https://maps.googleapis.com/maps/api/js",version:u}){if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=e,this.authReferrerPolicy=s,this.channel=a,this.client=o,this.id=n||i,this.language=l,this.libraries=c,this.mapIds=d,this.nonce=h,this.region=g,this.retries=p,this.url=m,this.version=u,r.instance){if(!t(this.options,r.instance.options))throw new Error(`Loader must not be called again with different options. ${JSON.stringify(this.options)} !== ${JSON.stringify(r.instance.options)}`);return r.instance}r.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?s.FAILURE:this.done?s.SUCCESS:this.loading?s.LOADING:s.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){let e=this.url;return e+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(e+=`&key=${this.apiKey}`),this.channel&&(e+=`&channel=${this.channel}`),this.client&&(e+=`&client=${this.client}`),this.libraries.length>0&&(e+=`&libraries=${this.libraries.join(",")}`),this.language&&(e+=`&language=${this.language}`),this.region&&(e+=`&region=${this.region}`),this.version&&(e+=`&v=${this.version}`),this.mapIds&&(e+=`&map_ids=${this.mapIds.join(",")}`),this.authReferrerPolicy&&(e+=`&auth_referrer_policy=${this.authReferrerPolicy}`),e}deleteScript(){const e=document.getElementById(this.id);e&&e.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise(((e,t)=>{this.loadCallback((i=>{i?t(i.error):e(window.google)}))}))}importLibrary(e){return this.execute(),google.maps.importLibrary(e)}loadCallback(e){this.callbacks.push(e),this.execute()}setScript(){var e,t;if(document.getElementById(this.id))return void this.callback();const i={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(i).forEach((e=>!i[e]&&delete i[e])),(null===(t=null===(e=null===window||void 0===window?void 0:window.google)||void 0===e?void 0:e.maps)||void 0===t?void 0:t.importLibrary)||(e=>{let t,i,s,r="The Google Maps JavaScript API",a="google",o="importLibrary",n="__ib__",l=document,c=window;c=c[a]||(c[a]={});const d=c.maps||(c.maps={}),h=new Set,g=new URLSearchParams,p=()=>t||(t=new Promise(((o,c)=>{return p=this,m=void 0,y=function*(){var p;for(s in yield i=l.createElement("script"),i.id=this.id,g.set("libraries",[...h]+""),e)g.set(s.replace(/[A-Z]/g,(e=>"_"+e[0].toLowerCase())),e[s]);g.set("callback",a+".maps."+n),i.src=this.url+"?"+g,d[n]=o,i.onerror=()=>t=c(Error(r+" could not load.")),i.nonce=this.nonce||(null===(p=l.querySelector("script[nonce]"))||void 0===p?void 0:p.nonce)||"",l.head.append(i)},new((u=void 0)||(u=Promise))((function(e,t){function i(e){try{r(y.next(e))}catch(e){t(e)}}function s(e){try{r(y.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof u?r:new u((function(e){e(r)}))).then(i,s)}r((y=y.apply(p,m||[])).next())}));var p,m,u,y})));d[o]?console.warn(r+" only loads once. Ignoring:",e):d[o]=(e,...t)=>h.add(e)&&p().then((()=>d[o](e,...t)))})(i);const s=this.libraries.map((e=>this.importLibrary(e)));s.length||s.push(this.importLibrary("core")),Promise.all(s).then((()=>this.callback()),(e=>{const t=new ErrorEvent("error",{error:e});this.loadErrorCallback(t)}))}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(e){if(this.errors.push(e),this.errors.length<=this.retries){const e=this.errors.length*Math.pow(2,this.errors.length);console.error(`Failed to load Google Maps script, retrying in ${e} ms.`),setTimeout((()=>{this.deleteScript(),this.setScript()}),e)}else this.onerrorEvent=e,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach((e=>{e(this.onerrorEvent)})),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version)return console.warn("Google Maps already loaded outside @googlemaps/js-api-loader.This may result in undesirable behavior as options and script parameters may not match."),void this.callback();this.loading||(this.loading=!0,this.setScript())}}}const a=[{featureType:"landscape",stylers:[{saturation:-100},{lightness:65},{visibility:"on"}]},{featureType:"poi",stylers:[{saturation:-100},{lightness:51},{visibility:"simplified"}]},{featureType:"road.highway",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"road.arterial",stylers:[{saturation:-100},{lightness:30},{visibility:"on"}]},{featureType:"road.local",stylers:[{saturation:-100},{lightness:40},{visibility:"on"}]},{featureType:"transit",stylers:[{saturation:-100},{visibility:"simplified"}]},{featureType:"administrative.province",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"on"},{lightness:-25},{saturation:-100}]},{featureType:"water",elementType:"geometry",stylers:[{hue:"#ffff00"},{lightness:-25},{saturation:-97}]}];class o{constructor(e){this.debug=!0,this.debug=!0,this.fullScreen=!1,this.visibleBuildings=!0,this.useMarkerCluster=!0,this.infowindow=null,this.loader=new r({apiKey:"AIzaSyB5nfDa-d2SUi6t8wrrWABICZH8qHu-Hfc",version:"weekly",libraries:["core","maps","marker"]}),this.google=null,this.marker=null,this.core=null,this.arrayCategoriesText=[],this.icons=[],this.mapId=e,this.map=null,this.markers=[],this.clusterer=null,this.serverHost="http://localhost:9000"}async initMap(){try{const[e,t,i]=await Promise.all([this.loader.importLibrary("maps"),this.loader.importLibrary("marker"),this.loader.importLibrary("core")]);this.google=e,this.marker=t,this.core=i;const s=document.getElementById(this.mapId);return this.map=new this.google.Map(s,{center:{lat:41.44090875484817,lng:1.81713925781257},zoom:8,maxZoom:20,minZoom:4,disableDefaultUI:!1,scrollwheel:!0,draggable:!0,mapTypeControl:!0,mapTypeControlOptions:{style:this.google.MapTypeControlStyle.DROPDOWN_MENU,position:this.core.ControlPosition.TOP_LEFT},panControl:!0,panControlOptions:{position:this.core.ControlPosition.TOP_RIGHT},zoomControl:!0,zoomControlOptions:{position:this.core.ControlPosition.LEFT_TOP},scaleControl:!0,streetViewControl:!0,streetViewControlOptions:{position:this.core.ControlPosition.LEFT_TOP},fullscreenControl:!0,fullscreenControlOptions:{position:this.core.ControlPosition.TOP_LEFT},mapTypeId:this.google.MapTypeId.ROADMAP,cluster:!0,styles:a}),this._setLogoCatalunyaMedieval(),this._setIconFullScreen(),this._setRemoveAllIcons(),this.map}catch(e){console.error("Error loading the Google Maps script",e)}}addMarker(e){const t=this.createMarker(e);this.markers.push(t),this.addMarkerToCluster(t),this.addContentToMarker(e,t),this._createMarkerButton(t,e)}addContentToMarker(e,t){if(e.content){null===this.infowindow&&(this.infowindow=new this.google.InfoWindow({content:e.content,position:t.getPosition()}));const i=this;t.addListener("click",(function(){i.infowindow.setContent(e.content),i.infowindow.setPosition(t.getPosition()),i.infowindow.open({anchor:t,shouldFocus:!1})})),google.maps.event.addListener(this.infowindow,"domready",(function(){let e=$(".catmed-google-maps-marker-close");google.maps.event.addDomListener(e[0],"click",(function(){i.infowindow.close()}))}))}}addMarkerToCluster(e){this.useMarkerCluster&&(null==this.clusterer&&(this.clusterer=new MarkerClusterer(this.map,[],{imagePath:"https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",minimumClusterSize:15})),this.clusterer.addMarker(e))}createMarker(e){return new this.marker.Marker({position:{lat:e.lat,lng:e.lng},map:this.map,title:e.title,icon:e.icon,visible:e.visible,category:e.category})}_exist(e){let t=!1;return-1!==this.arrayCategoriesText.indexOf(e)&&(t=!0),t}_createMarkerButton(e,t){const i=document.getElementById("mapLlist");if(!this._exist(t.category)){this.arrayCategoriesText.push(t.category);const e=document.createElement("li");e.innerHTML=t.categoryName,e.setAttribute("class",t.category+" header"),i.appendChild(e)}const s=document.createElement("li");s.innerHTML=t.title,s.setAttribute("class",t.category),i.appendChild(s);const r=this;google.maps.event.addDomListener(s,"click",(function(){r.map.setZoom(15),r.map.setCenter(e.getPosition()),r.map.setTilt(1),google.maps.event.trigger(e,"click")})),google.maps.event.addDomListener(s,"mouseover",(function(){e.setZIndex(2e3),e.setIcon(t.icon2)})),google.maps.event.addDomListener(s,"mouseout",(function(){e.setZIndex(1),e.setIcon(t.icon)}))}_setRemoveAllIcons(){const e=this,t=document.createElement("div");t.style.padding="2px";const i=document.createElement("div");i.style.cursor="pointer",i.style.textAlign="center",i.title="Click per mostrar o ocultar totes les edificacions",t.appendChild(i);const s=document.createElement("div");s.id="visibleBuildings",s.innerHTML='<img src="'+this.serverHost+'/images/catalunya-gmap/gmap/06.png" width="32" height="32" alt="Click per mostrar o ocultar totes les edificacions" >',i.appendChild(s),this.map.controls[this.core.ControlPosition.RIGHT_TOP].push(t),google.maps.event.addDomListener(i,"click",(function(){let t="05";e.visibleBuildings||(t="06"),$("#visibleBuildings").html('<img src="'+e.serverHost+"/images/catalunya-gmap/gmap/"+t+'.png" width="32" height="32" alt="Click per mostrar o ocultar totes les edificacions" >'),e.visibleBuildings=!e.visibleBuildings,e._changeVisibility(e.visibleBuildings),e.clusterer.resetViewport_(),e.clusterer.redraw_()}))}addIcon(e){this._createIcon(e),this.icons.push(e)}_createIcon(e){const t=document.createElement("div");t.style.padding="2px";const i=document.createElement("div");i.style.cursor="pointer",i.style.textAlign="center",i.title="Click per activar o desactivar "+e.title,t.appendChild(i);const s=document.createElement("div");s.innerHTML='<img id="img-'+e.category+'" src="'+e.icon+'" alt="'+e.title+'" >',i.appendChild(s),this.map.controls[this.core.ControlPosition.RIGHT_TOP].push(t);const r=this;return google.maps.event.addDomListener(i,"click",(function(){e.visible=!e.visible,r._setVisible(e.category,e.visible),r.clusterer.resetViewport_(),r.clusterer.redraw_()})),t}_changeVisibility(e){const t=this;this.icons.forEach((function(i){i.visible=e,t._setVisible(i.category,e)}))}_setLogoCatalunyaMedieval(){const e=document.createElement("div");e.index=10,e.style.padding="0px";const t=document.createElement("img");t.src=this.serverHost+"/images/catalunya-gmap/logo/logoCM-red-mini.png",t.style.cursor="pointer",e.appendChild(t),this.map.controls[this.core.ControlPosition.BOTTOM_LEFT].push(e)}_setIconFullScreen(){const e=this,t=document.createElement("div");t.style.padding="2px";const i=document.createElement("div");i.style.cursor="pointer",i.style.textAlign="center",i.title="Click per mostrar o ocultar el llistat",i.style.visibility="visible",t.appendChild(i);const s=document.createElement("div");s.id="llistat",s.innerHTML='<img src="'+this.serverHost+'/images/catalunya-gmap/gmap/03.png" width="42" height="42" alt="Mostrar llistat" >',i.appendChild(s),this.map.controls[this.core.ControlPosition.TOP_RIGHT].push(t),google.maps.event.addDomListener(i,"click",(function(){$("#primaryDiv").toggleClass("primaryDiv"),e._resize(!0),$("#secondaryDiv").toggle();let t="04";e.fullScreen||(t="03"),e.fullScreen=!e.fullScreen,$("#llistat").html('<img src="'+e.serverHost+"/images/catalunya-gmap/gmap/"+t+'.png" with="42" height="42" alt="Ocultar llistat" >')}))}_setVisible(e,t){t?(this.enableMarkersByCategory(e),this._enableText(e),$("#img-"+e).css("opacity","1")):(this.disableMarkersByCategory(e),this._disableText(e),$("#img-"+e).css("opacity","0.5")),this._resize(!1)}_enableText(e){e="."+e,$(e).each((function(){$(this).show()}))}_disableText(e){e="."+e,$(e).each((function(){$(this).hide()}))}enableMarkersByCategory(e){const t=this;t.markers.forEach((function(i){i.category===e&&(i.setVisible(!0),t.clusterer.addMarker(i,!0))}))}disableMarkersByCategory(e){const t=this;t.markers.forEach((function(i){i.category===e&&(i.setVisible(!1),t.clusterer.removeMarker(i,!0))}))}_resize(e){if(this.clusterer.getMarkers().length>0)this.debug&&(console.log("markerClusterer : it is not empty!",this.clusterer.getMarkers().length),console.log("Recenter markers!")),this._refreshMap(),e&&(this.clusterer.fitMapToMarkers(),this.clusterer.repaint());else{this.debug&&(console.log("Marker Clusterer : it is empty!"),console.log("Recenter the map to Catalunya Area"));const e=41.44090875484817,t=1.81713925781257;new google.maps.LatLng(e,t),this.map.setZoom(8)}}_on(e){const t=this;google.maps.event.addListener(e.obj,e.event,(function(i){return e.callback.call(t,i)}))}_refreshMap(){google.maps.event.trigger(this.map,"resize")}_getMarkers(){return this.markers}}class n{constructor(e){this.mapManager=new o(e),this.map=null,this.styleType1=7,this.styleType2=6,this.serverHost="http://localhost:9000"}async create(){return this.map=await this.mapManager.initMap(),this.addMilitars(),this.addReligioses(),this.addCivils(),this.addAltresLlocsInteres(),this.mapManager._resize(),this.mapManager}addMilitars(){this.addCastells(),this.addEpocaCarlina(),this.addMuralles(),this.addTorres()}addCivils(){this.addCasaForta(),this.addPalau(),this.addPont(),this.addTorreColomer()}addReligioses(){this.addBasilica(),this.addCatedral(),this.addErmita(),this.addEsglesia(),this.addEsglesiaFortificada(),this.addMonestir()}addAltres(){this.addAltresLlocsInteres()}addCastells(){this._addEdifici(1,aCastells,"castell","Castells","militar")}addEpocaCarlina(){this._addEdifici(2,aEpocaCarlina,"epoca-carlina","Època Carlina","militar")}addMuralles(){this._addEdifici(3,aMuralles,"muralles","Muralles","militar")}addTorres(){this._addEdifici(4,aTorres,"torre","Torres","militar")}addCasaForta(){this._addEdifici(5,aCasaForta,"casa-forta","Cases Fortes","civil")}addPalau(){this._addEdifici(6,aPalau,"palau","Palaus","civil")}addPont(){this._addEdifici(7,aPont,"pont","Ponts","civil")}addTorreColomer(){this._addEdifici(8,aTorreColomer,"torre-colomer","Torres Colomer","civil")}addBasilica(){this._addEdifici(9,aBasilica,"basilica","Basíliques","religios")}addCatedral(){this._addEdifici(10,aCatedral,"catedral","Catedrals","religios")}addErmita(){this._addEdifici(11,aErmita,"ermita","Ermites","religios")}addEsglesia(){this._addEdifici(12,aEsglesia,"esglesia","Esglésies","religios")}addEsglesiaFortificada(){this._addEdifici(13,aEsglesiaFortificada,"esglesia-fortificada","Esglésies fortificades","religios")}addMonestir(){this._addEdifici(14,aMonestir,"monestir","Monestirs","religios")}addAltresLlocsInteres(){this._addEdifici(15,aAltres,"altres-llocs-dinteres","Altres llocs d'Interés","altres")}_getIcon1(e,t){return this.serverHost+"/images/catalunya-gmap/gmap/"+e+"/"+t+"/"+t+this.styleType1+".png"}_getIcon2(e,t){return this.serverHost+"/images/catalunya-gmap/gmap/"+e+"/"+t+"/"+t+this.styleType2+".png"}_createContent(e,t,i,s,r,a,o){let n="";(s||r||a)&&(s&&(n+=s+", "),r&&(n+=r+", "),s===r&&(n=s+", "),a&&(n+=a),s===r&&r===a&&(n=s));let l="";return l+="<div class='catmed-google-maps-marker'>",l+="    <div class='catmed-google-maps-marker-close' >",l+="        <svg width='8' height='8' viewBox='0 0 14 14'>",l+="            <path transform='translate(-18 -13)' d='M32 14.4L30.6 13 25 18.6 19.4 13 18 14.4l5.6 5.6-5.6 5.6 1.4 1.4 5.6-5.6 5.6 5.6 1.4-1.4-5.6-5.6z'></path>",l+="        </svg>",l+="    </div>",l+="    <div class='catmed-google-maps-marker-header'>",l+="            <div class='catmed-google-maps-marker-image'><img alt='The Museum of Modern Art' src='https://files.elfsightcdn.com/86d592a4-fc00-4d16-9b84-0566a28d5645/423cf9be-c155-4209-8f60-75ae45d9bcec/moma_renovation_and_expansion--1-.jpg'></div>",l+="    </div>",l+="    <div class='catmed-google-maps-marker-title-wrapper "+o+"'>",l+="            <a class='catmed-google-maps-marker-link-image' href='"+t+"' >",l+="                <span class='catmed-google-maps-marker-title'>"+e+"</span>",l+="            </a>",l+="        <div class='catmed-google-maps-marker-directions'>",l+="            <a class='catmed-google-maps-marker-directions-button' href='https://www.google.com/maps/dir/?api=1&amp;destination=40.7614327, -73.97762159999999' target='_blank' rel='nofollow'>",l+="                <span class='catmed-google-maps-marker-directions-label'>Ruta</span>",l+="                <span class='catmed-google-maps-marker-directions-icon'>",l+="                    <svg width='20px' height='20px' viewBox='0 0 510 510'>",l+="                        <g>",l+="                            <g id='directions'>",l+="                                 <path d='M502.35,237.149l-229.5-229.5l0,0c-10.199-10.2-25.5-10.2-35.7,0l-229.5,229.5c-10.2,10.2-10.2,25.501,0,35.7l229.5,229.5",l+="                                l0,0c10.2,10.2,25.501,10.2,35.7,0l229.5-229.5C512.55,262.65,512.55,247.35,502.35,237.149z M306,318.75V255H204v76.5h-51v-102",l+="                                    c0-15.3,10.2-25.5,25.5-25.5H306v-63.75l89.25,89.25L306,318.75z'></path>",l+="                            </g>",l+="                         </g>",l+="                     </svg>",l+="                 </span>",l+="              </a>",l+="          </div>",l+="    </div>",l+="    <div class='catmed-google-maps-marker-content'>",l+="        <div class='catmed-google-maps-marker-info'>",l+="            <div class='catmed-google-maps-marker-info-item-address catmed-google-maps-marker-info-item'>",l+="                <div class='catmed-google-maps-marker-info-item-icon-wrapper'>",l+="                    <svg class='catmed-google-maps-marker-info-item-icon' width='12px' height='12px' viewBox='0 0 510 510'>",l+="                        <path d='M255,0C155.55,0,76.5,79.05,76.5,178.5C76.5,311.1,255,510,255,510s178.5-198.9,178.5-331.5C433.5,79.05,354.45,0,255,0zM255,242.25c-35.7,0-63.75-28.05-63.75-63.75s28.05-63.75,63.75-63.75s63.75,28.05,63.75,63.75S290.7,242.25,255,242.25z'></path>",l+="                    </svg>",l+="                </div>",l+="                <span class='catmed-google-maps-marker-info-item-text'>"+n+"</span>",l+="            </div>",l+="        </div>",l+="    </div>",l+="</div>",l}_extract(e,t,i,s,r){return{id:t+s,title:e.title,link:e.link,type:r,lat:parseFloat(e.position.lat),lng:parseFloat(e.position.long),visible:!0,content:this._createContent(e.title,e.link,e.thumbs,e.municipi,e.poblacio,e.provincia,r),icon:this._getIcon1(r,t),icon2:this._getIcon2(r,t),category:t,categoryName:i}}_addEdifici(e,t,i,s,r){if(t.length>0){t.forEach(((e,t)=>{const a=this._extract(e,i,s,t,r);this.mapManager.addMarker(a)}));const a=this._getIcon1(r,i);this.mapManager.addIcon({id:e,visible:!0,title:s,category:i,icon:a})}}}document.addEventListener("DOMContentLoaded",(async function(){try{const e=new n("gMap"),t=await e.create();t._getMarkers().length>0&&$("#error").hide(),$(window).resize((function(){t._resize()}))}catch(e){console.error("Failed to load the Google Maps API",e)}}))})();