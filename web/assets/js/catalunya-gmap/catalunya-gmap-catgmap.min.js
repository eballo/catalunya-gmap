/*! Generated 13-11-2017 */

!function(e,t,i,r){var n=function(){function e(e,n,s){this.debug=s.debug,this.findUser=s.findUser,this.serverHost=s.serverHost,this.gMap=new t.maps.Map(e,n),this.markers=i.create(),this.icons=r.create();var a={minimumClusterSize:15};this.markerClusterer=new MarkerClusterer(this.gMap,[],a),this.infowindow=new t.maps.InfoWindow,this.infowindowUser=new t.maps.InfoWindow,this.fullScreen=!0,this.useMarkerCluster=s.useMarkerCluster,this.arrayCategoriesText=i.create(),this.bounds=new t.maps.LatLngBounds,this._setLogoCatalunyaMedieval(),this._setIconFullScreen(),this._setRemoveAllIcons()}return e.prototype={_findUser:function(){self=this,navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};console.log(t),self.infowindowUser.setPosition(t),self.infowindowUser.setContent("Location found."),self.infowindowUser.open(self.gMap),self.gMap.setCenter(t)},function(){_handleLocationError(!0,self.gMap.getCenter())}):_handleLocationError(!1,self.gMap.getCenter())},_handleLocationError:function(e,t){this.infowindowUser.setPosition(t),this.infowindowUser.setContent(e?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation."),this.infowindowUser.open(this.gMap)},_setRemoveAllIcons:function(e){var i=this,r=document.createElement("div");r.style.padding="2px";var n=document.createElement("div");n.style.cursor="pointer",n.style.textAlign="center",n.title="Click per mostrar o ocultar totes les edificacions",r.appendChild(n);var s=document.createElement("div");s.id="visibleBuildings",s.innerHTML='<img src='+this.serverHost+'"/web/images/catalunya-gmap/gmap/06.png" with="32" height="32" alt="Click per mostrar o ocultar totes les edificacions" >',n.appendChild(s),this.gMap.controls[t.maps.ControlPosition.RIGHT_TOP].push(r),t.maps.event.addDomListener(n,"click",function(){visibleBuildings?(visibleBuildings=!1,$("#visibleBuildings").html('<img src='+i.serverHost+'"/web/images/catalunya-gmap/gmap/05.png" with="32" height="32" alt="Click per mostrar o ocultar totes les edificacions" >')):(visibleBuildings=!0,$("#visibleBuildings").html('<img src='+i.serverHost+'"/web/images/catalunya-gmap/gmap/06.png" with="32" height="32" alt="Click per mostrar o ocultar totes les edificacions" >')),i._cangeVisibility(visibleBuildings),i.markerClusterer.resetViewport_(),i.markerClusterer.redraw_()})},_cangeVisibility:function(e){var t=this;this.icons.getItems().forEach(function(i){i.visible=e,t._setVisible(i.category,e)})},_setLogoCatalunyaMedieval:function(){var e=document.createElement("div");e.index=10,e.style.padding="0px";var i=document.createElement("img");i.src=this.serverHost+"/assets/images/catalunya-gmap/logo/logoCM-red-mini.png",i.style.cursor="pointer",e.appendChild(i),this.gMap.controls[t.maps.ControlPosition.BOTTOM_LEFT].push(e)},_setIconFullScreen:function(e){var i=this,r=document.createElement("div");r.style.padding="2px";var n=document.createElement("div");n.style.cursor="pointer",n.style.textAlign="center",n.title="Click per mostrar o ocultar el llistat",n.style.visibility="visible",r.appendChild(n);var s=document.createElement("div");s.id="llistat",s.innerHTML='<img src='+this.serverHost+'"/web/images/catalunya-gmap/gmap/03.png" with="42" height="42" alt="Mostrar llistat" >',n.appendChild(s),this.gMap.controls[t.maps.ControlPosition.TOP_RIGHT].push(r),t.maps.event.addDomListener(n,"click",function(){$("#primaryDiv").toggleClass("primaryDiv"),i._resize(!0),$("#secondaryDiv").toggle(),i.fullScreen?(i.fullScreen=!1,$("#llistat").html('<img src='+i.serverHost+'"/web/images/catalunya-gmap/gmap/04.png" with="42" height="42" alt="Ocultar llistat" >')):(i.fullScreen=!0,$("#llistat").html('<img src='+i.serverHost+'"/web/images/catalunya-gmap/gmap/03.png" with="42" height="42" alt="Mostrar llistat" >'))})},_resize:function(e){if(this.markerClusterer.getMarkers().length>0)this.debug&&(console.log("markerClusterer : it is not empty!"),console.log("Recenter markers!")),this.findUser&&this._findUser(),this._refreshMap(),e&&(this.markerClusterer.fitMapToMarkers(),this.markerClusterer.repaint());else{this.debug&&(console.log("markerClusterer : it is empty!"),console.log("Recenter the map to Catalunya Area"));var i=new t.maps.LatLng(41.44090875484817,1.81713925781257);this.gMap.setZoom(8),this.gMap.setCenter(i)}},_refreshMap:function(){t.maps.event.trigger(this.gMap,"resize")},_on:function(e){var i=this;t.maps.event.addListener(e.obj,e.event,function(t){return e.callback.call(i,t)})},_createMarker:function(e){return e.map=this.gMap,new t.maps.Marker(e)},_createIcon:function(e){var i=document.createElement("div");i.style.padding="2px";var r=document.createElement("div");r.style.cursor="pointer",r.style.textAlign="center",r.title="Click per activar o desactivar "+e.title,i.appendChild(r);var n=document.createElement("div");n.innerHTML='<img id="img-'+e.category+'" src="'+e.icon+'" alt="'+e.title+'" >',r.appendChild(n),this.gMap.controls[t.maps.ControlPosition.RIGHT_TOP].push(i);var s=this;return t.maps.event.addDomListener(r,"click",function(){e.visible?e.visible=!1:e.visible=!0,s._setVisible(e.category,e.visible),s.markerClusterer.resetViewport_(),s.markerClusterer.redraw_()}),i},_setVisible:function(e,t){t?(this.enableBy(function(t){return t.category===e}),this._enableText(e),$("#img-"+e).css("opacity","1")):(this.disableBy(function(t){return t.category===e}),this._disableText(e),$("#img-"+e).css("opacity","0.5"))},addIcon:function(e){this._createIcon(e),this.icons.add(e)},removeIcon:function(e){},addMarker:function(e){var i;e.position={lat:e.lat,lng:e.lng},i=this._createMarker(e),this.bounds.extend(i.getPosition()),this.useMarkerCluster&&this.markerClusterer.addMarker(i),this.markers.add(i),e.event&&this._on({obj:i,event:e.event.name,callback:e.event.callback}),e.content&&this._on({obj:i,event:"click",callback:function(){this.infowindow.setContent(e.content),this.infowindow.setPosition(i.getPosition()),this.infowindow.open(this.gMap,i)}}),this._createMarkerButton(i,e),t.maps.event.addListener(this.infowindow,"domready",function(){var e=$(".gm-style-iw").prev();e.css({"background-color":"#fff6eb"}),e.children(":nth-child(4)").css({"background-color":"#fff6eb"}),e.children(":nth-child(3)").children(":nth-child(1)").children(":nth-child(1)").css({"background-color":"#fff6eb"}),e.children(":nth-child(3)").children(":nth-child(2)").children(":nth-child(1)").css({"background-color":"#fff6eb"})})},_createMarkerButton:function(e,i){var r=document.getElementById("mapLlist");if(!this.arrayCategoriesText.exist(i.category)){this.arrayCategoriesText.add(i.category);var n=document.createElement("li"),s=i.categoryName;n.innerHTML=s,n.setAttribute("class",i.category+" header"),r.appendChild(n)}var a=document.createElement("li"),o=i.title;a.innerHTML=o,a.setAttribute("class",i.category),r.appendChild(a);var l=this;t.maps.event.addDomListener(a,"click",function(){l.gMap.setZoom(15),l.gMap.setCenter(e.getPosition()),l.gMap.setTilt(1),t.maps.event.trigger(e,"click")}),t.maps.event.addDomListener(a,"mouseover",function(){e.setZIndex(2e3),e.setIcon(i.icon2)}),t.maps.event.addDomListener(a,"mouseout",function(){e.setZIndex(1),e.setIcon(i.icon)})},findBy:function(e){return this.markers.find(e)},removeBy:function(e){var t=this;t.markers.find(e,function(e){e.forEach(function(e){t.markerClusterer?t.markerClusterer.removeMarker(e):e.setMap(null)})})},_enableText:function(e){var e="."+e;$(e).each(function(){$(this).show()})},_disableText:function(e){var e="."+e;$(e).each(function(){$(this).hide()})},enableBy:function(e){var t=this;t.markers.find(e,function(e){e.forEach(function(e){e.setVisible(!0),t.markerClusterer.addMarker(e,!0)})}),this._resize(!0)},disableBy:function(e){var t=this;t.markers.find(e,function(e){e.forEach(function(e){e.setVisible(!1),t.markerClusterer.removeMarker(e,!0)})}),this._resize(!0)},_getMarkers:function(){return this.markers},zoom:function(e){if(!e)return this.gMap.getZoom();this.gMap.setZoom(e)}},e}();n.create=function(e,t,i){var e=document.getElementById(e);return new n(e,t,i)},e.Gmap=n}(window,google,List,Icons);